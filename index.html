<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Zombie Survival — Sprite Edition</title>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      background: #0b1220;
      font-family: Inter, system-ui, Segoe UI, Roboto, Arial;
    }

    canvas {
      display: block;
      margin: 0 auto;
      background: #1e2a38;
      box-shadow: 0 6px 30px rgba(0, 0, 0, 0.6);
      border-radius: 8px;
    }

    .hud {
      position: fixed;
      left: 20px;
      top: 20px;
      color: #fff;
      font-weight: 600;
    }
    .hud .line {
      font-size: 14px;
      margin: 6px 0;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .hud button {
      padding: 2px 6px;
      font-size: 12px;
      border: none;
      border-radius: 4px;
      background: #4a6bff;
      color: #fff;
      cursor: pointer;
    }
    .hud button:hover { background: #6a8dff; }

    .center-ui {
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      top: 20px;
      color: #fff;
      text-align: center;
    }

    .controls {
      position: fixed;
      right: 20px;
      top: 20px;
      color: #cfe3ff;
      text-align: right;
      font-size: 13px;
    }

    #shopUI {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #222;
      padding: 20px;
      border-radius: 10px;
      color: #fff;
      text-align: center;
      display: none;
      min-width: 220px;
    }
    #shopUI h2 { margin: 0 0 10px 0; }
    #shopUI button {
      display: block;
      margin: 6px auto;
      padding: 8px 16px;
      border: none;
      border-radius: 6px;
      background: #4a6bff;
      color: #fff;
      font-weight: bold;
      cursor: pointer;
    }
    #shopUI button:hover { background: #6a8dff; }

    #pausedOverlay,
    #gameOverOverlay,
    #homeScreen {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: none;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      color: #fff;
      text-align: center;
    }

    #pausedOverlay { background: rgba(0, 0, 0, 0.6); font-size: 36px; }
    #gameOverOverlay { background: rgba(0, 0, 0, 0.8); font-size: 28px; }

    #homeScreen { background: #0b1220; }
    #homeScreen h1 { font-size: 48px; margin-bottom: 20px; }
    #homeScreen .rules {
      max-width: 500px;
      margin: 20px auto;
      font-size: 16px;
      line-height: 1.5;
      color: #cfe3ff;
    }
    #homeScreen button {
      margin-top: 20px;
      padding: 12px 24px;
      font-size: 18px;
      border: none;
      border-radius: 8px;
      background: #4a6bff;
      color: #fff;
      cursor: pointer;
    }
    #homeScreen button:hover { background: #6a8dff; }
  </style>
</head>
<body>
  <!-- Home Screen -->
  <div id="homeScreen">
    <h1>Zombie Survival</h1>
    <div class="rules">
      <p>Survive through 20 waves of monsters.</p>
      <p>WASD to move, Shift to sprint, Mouse to aim & shoot.</p>
      <p>Earn money by killing monsters and use it to upgrade in the shop.</p>
      <p>Stay alive as long as you can — if HP hits 0, it’s game over!</p>
    </div>
    <button onclick="startGame()">Play</button>
  </div>

  <!-- HUD -->
  <div class="hud">
    <div class="line" id="hp">HP: 100</div>
    <div class="line" id="stamina">Stamina: 100</div>
    <div class="line" id="ammo">
      Ammo: 120/120
      <button onclick="refillAmmo()">Refill ($<span id="refillCost"></span>)</button>
    </div>
    <div class="line" id="money">Money: $0</div>
  </div>

  <!-- Wave Display -->
  <div class="center-ui">
    <div class="wave" id="waveTag">Wave 1 / 20</div>
  </div>

  <!-- Controls Info -->
  <div class="controls">
    <div>WASD to move • Shift to sprint • Mouse to aim</div>
    <div>Click to shoot • P to pause • R to restart after death</div>
  </div>

  <!-- Shop -->
  <div id="shopUI">
    <h2>Shop</h2>
    <button onclick="buyUpgrade('hp')">+20 Max Health ($<span id="cost-hp"></span>)</button>
    <button onclick="buyUpgrade('stamina')">+20 Max Stamina ($<span id="cost-stamina"></span>)</button>
    <<button onclick="buyUpgrade('maxAmmo')">+20 Max Ammo ($<span id="cost-ammo"></span>)</button>
    <button onclick="buyUpgrade('gun')">Buy Better Gun ($<span id="cost-gun"></span>)</button>
    <button onclick="skipShop()">Skip Shop</button>
  </div>

  <!-- Overlays -->
  <div id="pausedOverlay">PAUSED</div>
  <div id="gameOverOverlay">
    <div>GAME OVER</div>
    <button onclick="restartGame()">Restart</button>
  </div>

  <!-- Game Canvas -->
  <canvas id="game" width="1100" height="700"></canvas>

<script>
// ======================== CONFIG ========================
const CONFIG = {
  width: 1100,
  height: 700,
  maxWaves: 20,
  playerSpeed: 180,
  sprintMult: 1.7,
  bulletSpeed: 700,
  fireRate: 280
};

// ======================== SETUP =========================
const cvs = document.getElementById('game');
const ctx = cvs.getContext('2d');
ctx.imageSmoothingEnabled = false;

// ======================== SPRITES =======================
const SPRITES = {
  player: new Image(), zombie: new Image(), werewolf: new Image(), robot: new Image(),
  grass: new Image(), tree: new Image(), rock: new Image(), crate: new Image(),
  pistol: new Image(), rifle: new Image(), shotgun: new Image()
};
SPRITES.player.src   = "assets/sprites/player.png";
SPRITES.zombie.src   = "assets/sprites/zombie.png";
SPRITES.werewolf.src = "assets/sprites/werewolf.png";
SPRITES.robot.src    = "assets/sprites/robot.png";
SPRITES.grass.src    = "assets/sprites/grass.png";
SPRITES.tree.src     = "assets/sprites/tree.png";
SPRITES.rock.src     = "assets/sprites/rock.png";
SPRITES.crate.src    = "assets/sprites/crate.png";
SPRITES.pistol.src   = "assets/sprites/pistol.png";
SPRITES.rifle.src    = "assets/sprites/rifle.png";
SPRITES.shotgun.src  = "assets/sprites/shotgun.png";

function drawSprite(name, x, y, scale = 1) {
  const img = SPRITES[name];
  if (!img.complete) return;
  const w = img.width * scale;
  const h = img.height * scale;
  ctx.drawImage(img, Math.floor(x - w / 2), Math.floor(y - h / 2), w, h);
}

// ======================== INPUT =========================
let keys = {}, mouse = { x: CONFIG.width / 2, y: CONFIG.height / 2, down: false };
window.addEventListener('keydown', e => {
  keys[e.key.toLowerCase()] = true;
  if (e.key.toLowerCase() === 'p') togglePause();
  if (e.key.toLowerCase() === 'r' && game.ended) restartGame();
});
window.addEventListener('keyup', e => { keys[e.key.toLowerCase()] = false });
cvs.addEventListener('mousemove', e => {
  const rect = cvs.getBoundingClientRect();
  mouse.x = (e.clientX - rect.left) * (cvs.width / rect.width);
  mouse.y = (e.clientY - rect.top) * (cvs.height / rect.height);
});
cvs.addEventListener('mousedown', () => mouse.down = true);
cvs.addEventListener('mouseup', () => mouse.down = false);

// ======================== GAME STATE ====================
let game = { player: null, bullets: [], enemies: [], wave: 1, money: 0, paused: false, ended: false };
let shopCosts = { hp: 100, stamina: 120, ammo: 150, gun: 200 };
let refillCost = 50;

// ======================== PLAYER ========================
function createPlayer() {
  return {
    x: CONFIG.width / 2,
    y: CONFIG.height / 2,
    speed: CONFIG.playerSpeed,
    hp: 100, maxHp: 100,
    stamina: 100, maxStamina: 100,
    ammo: 120, maxAmmo: 120,
    lastShot: 0
  };
}

// ======================== ENEMIES =======================
function spawnEnemy() {
  let type = 'zombie';
  if (game.wave >= 12 && Math.random() < 0.3) type = 'robot';
  else if (game.wave >= 7 && Math.random() < 0.5) type = 'werewolf';

  let hp = 30;
  if (type === 'zombie') hp = 20 + game.wave * 3;
  if (type === 'werewolf') hp = 40 + game.wave * 4;
  if (type === 'robot') hp = 80 + game.wave * 6;

  game.enemies.push({
    x: Math.random() * CONFIG.width,
    y: Math.random() * CONFIG.height,
    type, hp, damage: 8
  });
}

// ======================== UPDATE ========================
function update(dt) {
  if (game.paused || game.ended) return;
  const p = game.player;

  // Movement
  let dx = 0, dy = 0;
  if (keys['w']) dy -= 1;
  if (keys['s']) dy += 1;
  if (keys['a']) dx -= 1;
  if (keys['d']) dx += 1;
  let mag = Math.hypot(dx, dy) || 1;
  dx /= mag; dy /= mag;
  let speed = p.speed;

  if (keys['shift'] && p.stamina > 0) {
    speed *= CONFIG.sprintMult;
    p.stamina -= 30 * dt;
  } else p.stamina = Math.min(p.maxStamina, p.stamina + 15 * dt);

  if (p.stamina < 0) p.stamina = 0;
  p.x += dx * speed * dt;
  p.y += dy * speed * dt;
  p.x = Math.max(16, Math.min(CONFIG.width - 16, p.x));
  p.y = Math.max(16, Math.min(CONFIG.height - 16, p.y));

  // Shooting
  if (mouse.down && performance.now() - p.lastShot > CONFIG.fireRate && p.ammo > 0) {
    p.lastShot = performance.now();
    p.ammo--;
    let mag = Math.hypot(mouse.x - p.x, mouse.y - p.y);
    game.bullets.push({
      x: p.x, y: p.y,
      vx: (mouse.x - p.x) / mag * CONFIG.bulletSpeed,
      vy: (mouse.y - p.y) / mag * CONFIG.bulletSpeed,
      life: 1
    });
  }

  // Bullets
  for (let b of game.bullets) {
    b.x += b.vx * dt;
    b.y += b.vy * dt;
    b.life -= dt;
  }
  game.bullets = game.bullets.filter(b => b.life > 0);

  // Enemies
  for (let e of game.enemies) {
    const ang = Math.atan2(p.y - e.y, p.x - e.x);
    let speed = (e.type === 'werewolf') ? 100 : (e.type === 'robot' ? 40 : 60);
    e.x += Math.cos(ang) * speed * dt;
    e.y += Math.sin(ang) * speed * dt;

    if (Math.hypot(p.x - e.x, p.y - e.y) < 25) {
      p.hp -= e.damage * dt;
      if (p.hp <= 0) { p.hp = 0; endGame(); }
    }
  }

  // Bullet collisions
  for (let b of game.bullets) {
    for (let e of game.enemies) {
      if (Math.hypot(b.x - e.x, b.y - e.y) < 20) {
        e.hp -= 20;
        b.life = 0;
        if (e.hp <= 0) game.money += 20;
      }
    }
  }
  game.enemies = game.enemies.filter(e => e.hp > 0);

  // Wave progression
  if (game.enemies.length === 0) {
    if (game.wave % 3 === 0) openShop();
    else {
      game.wave++;
      for (let i = 0; i < 5 + game.wave * 2; i++) spawnEnemy();
    }
  }
}

// ======================== RENDER ========================
function render() {
  ctx.clearRect(0, 0, CONFIG.width, CONFIG.height);

  // Background
  for (let x = 0; x < CONFIG.width; x += 32)
    for (let y = 0; y < CONFIG.height; y += 32)
      drawSprite('grass', x + 16, y + 16, 1);

  // Enemies
  for (let e of game.enemies) drawSprite(e.type, e.x, e.y, 1);

  // Bullets
  for (let b of game.bullets) {
    ctx.fillStyle = '#ffd27a';
    ctx.fillRect(b.x - 2, b.y - 2, 4, 4);
  }

  // Player
  drawSprite('player', game.player.x, game.player.y, 1);
}

// ======================== GAME LOOP =====================
let lastTime = 0;
function loop(ts) {
  if (!lastTime) lastTime = ts;
  let dt = (ts - lastTime) / 1000;
  lastTime = ts;
  update(dt);
  render();
  updateHUD();
  requestAnimationFrame(loop);
}

// ======================== HUD ===========================
function updateHUD() {
  const p = game.player;
  document.getElementById('hp').textContent     = `HP: ${Math.round(p.hp)}/${p.maxHp}`;
  document.getElementById('stamina').textContent = `Stamina: ${Math.round(p.stamina)}/${p.maxStamina}`;
  document.getElementById('ammo').firstChild.textContent = `Ammo: ${p.ammo}/${p.maxAmmo} `
  document.getElementById('money').textContent = `Money: $${game.money}`;
  document.getElementById('refillCost').textContent = refillCost;
  document.getElementById('waveTag').textContent = `Wave ${game.wave} / ${CONFIG.maxWaves}`;

  // Shop costs display
  document.getElementById('cost-hp').textContent = shopCosts.hp;
  document.getElementById('cost-stamina').textContent = shopCosts.stamina;
  document.getElementById('cost-ammo').textContent = shopCosts.ammo;
  document.getElementById('cost-gun').textContent = shopCosts.gun;
}

// ======================== SHOP =========================
function openShop() {
  document.getElementById('shopUI').style.display = 'block';
  game.paused = true;
}

function skipShop() {
  document.getElementById('shopUI').style.display = 'none';
  game.wave++;
  for (let i = 0; i < 5 + game.wave * 2; i++) spawnEnemy();
  game.paused = false;
}

function buyUpgrade(type) {
  const cost = shopCosts[type];
  if (game.money < cost) return;

  game.money -= cost;
  shopCosts[type] = Math.round(cost * 1.5);

  if (type === 'hp') game.player.maxHp += 20;
  if (type === 'stamina') game.player.maxStamina += 20;
  if (type === 'ammo') game.player.maxAmmo += 20;
  if (type === 'gun') CONFIG.fireRate = Math.max(120, CONFIG.fireRate - 60);

  document.getElementById('shopUI').style.display = 'none';
  game.wave++;
  for (let i = 0; i < 5 + game.wave * 2; i++) spawnEnemy();
  game.paused = false;
}

function refillAmmo() {
  if (game.money >= refillCost) {
    game.money -= refillCost;
    game.player.ammo = game.player.maxAmmo;
  }
}

// ======================== GAME OVER ====================
function endGame() {
  game.ended = true;
  document.getElementById('gameOverOverlay').style.display = 'flex';
}

function restartGame() {
  document.getElementById('gameOverOverlay').style.display = 'none';
  startGame();
}

// ======================== PAUSE ========================
function togglePause() {
  if (game.ended) return;
  game.paused = !game.paused;
  document.getElementById('pausedOverlay').style.display = game.paused ? 'flex' : 'none';
}

// ======================== START ========================
function startGame() {
  document.getElementById('homeScreen').style.display = 'none';
  game = { player: createPlayer(), bullets: [], enemies: [], wave: 1, money: 0, paused: false, ended: false };
  for (let i = 0; i < 7; i++) spawnEnemy();
  lastTime = 0;
  requestAnimationFrame(loop);
}
</script>
</body>
</html>
